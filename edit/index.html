<!doctype html>
<!-- See http://www.firepad.io/docs/ for detailed embedding docs. -->
<html>
<head>
<meta charset="utf-8" />
<!-- skulpt stuff -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="skulpt.min.js" type="text/javascript"></script> 
<script src="skulpt-stdlib.js" type="text/javascript"></script> 


<!-- Firebase -->
<script src="https://cdn.firebase.com/js/client/2.0.2/firebase.js"></script>

<!-- ACE and its JavaScript mode and theme files -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-python.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/theme-textmate.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/keybinding-vim.js"></script>

<!-- Firepad -->
<link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.1.0/firepad.css" />
<script src="https://cdn.firebase.com/libs/firepad/1.1.0/firepad.min.js"></script>

<style>
html { height: 100%; }
body { margin: 0; height: 100%; }
/* Height / width / positioning can be customized for your use case.
   For demo purposes, we make firepad fill the entire browser. */
#firepad-container {
    top:0;
    width: 49%;
    height: 100%;
    float:left;
}
#output-area {
    background:black;
    color:lightgreen;
    top:0;
    width: 49%;
    height:100%;
    float:right;
}
#output {
	padding:2em;
}
#controls {
    background:lightgray;
}
</style>
</head>

<body>
<div id="controls">
  <button type="button" onclick="runit()">Run</button> 
  <button type="button" onclick="clearit()">Clear</button> 
</div>
<div id="output-area">
<pre id="output" ></pre> 
<!-- If you want turtle graphics include a canvas -->
<canvas id="mycanvas" ></mycanvas> 
</div>
<div id="firepad-container"></div>

<script>
function init() {
	//// Initialize Firebase.
	var firepadRef = getExampleRef();
	// TODO: Replace above line with:
	// var ref = new Firebase('<YOUR FIREBASE URL>');

	//// Create ACE
	var editor = ace.edit("firepad-container");
	editor.setTheme("ace/theme/textmate");
	var session = editor.getSession();
	session.setUseWrapMode(true);
	session.setUseWorker(false);
	// session.setMode("ace/mode/javascript");
	session.setMode("ace/mode/python");
	editor.setKeyboardHandler("ace/keyboard/vim");

	//// Create Firepad.
	var firepad = Firepad.fromACE(firepadRef, editor, {
defaultText: '# Python Editing with Firepad!\ndef go():\n    print "Hello, world.";\n\n'
});
}

// Helper to get hash from end of URL or generate a random one.
function getExampleRef() {
	// var ref = new Firebase('https://firepad.firebaseio-demo.com');
	var ref = new Firebase('https://haxor.firebaseio.com');
	var hash = window.location.hash.replace(/#/g, '');
	if (hash) {
		ref = ref.child(hash);
	} else {
		ref = ref.push(); // generate unique location.
		window.location = window.location + '#' + ref.key(); // add it as a hash to the URL.
	}
	/*
	   if (typeof console !== 'undefined')
	   console.log('Firebase data: ', ref.toString());
	 */
	return ref;
}

window.onload = init;
</script>

<script type="text/javascript"> 
// output functions are configurable.  This one just appends some text
// to a pre element.
function clearit() { 
	var mypre = document.getElementById("output"); 
	mypre.innerHTML = '';
} 
function outf(text) { 
	var mypre = document.getElementById("output"); 
	mypre.innerHTML = mypre.innerHTML + text; 
} 
function builtinRead(x) {
	if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
		throw "File not found: '" + x + "'";
	return Sk.builtinFiles["files"][x];
}

// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
// console.log('defining runit');

function runit() { 
	var editor = ace.edit("firepad-container");
	var code = editor.getSession().getValue();
	var mypre = document.getElementById("output"); 
	mypre.innerHTML = ''; 
	Sk.canvas = "mycanvas";
	Sk.pre = "output";
	Sk.configure({output:outf, read:builtinRead}); 
	try {
		eval(Sk.importMainWithBody("<stdin>",false,code)); 
	}
	catch(e) {
		alert(e.toString())
	}
} 
</script> 
</body>
</html>
